<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Cloudpy by Tefx</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Cloudpy</h1>
        <h2>run python script on remote cloud platform</h2>

        <section id="downloads">
          <a href="https://github.com/Tefx/cloudpy/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/Tefx/cloudpy/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/Tefx/cloudpy" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="cloudpy" class="anchor" href="#cloudpy" aria-hidden="true"><span class="octicon octicon-link"></span></a>cloudpy</h1>

<p>run python script in virtual environment on a remote platform</p>

<h1>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install</h1>

<pre><code>$pip install cloudpy
</code></pre>

<p>And a config file is also needed. You can put the configurations in <code>/etc/cloudpy.conf</code>, <code>~/.cloudpy.conf</code>, or <code>./cloudpy.conf</code>.<br>
See the cloudpy.conf for a sample.</p>

<h1>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h1>

<h2>
<a id="the-easy-way" class="anchor" href="#the-easy-way" aria-hidden="true"><span class="octicon octicon-link"></span></a>The easy way</h2>

<pre><code>$cloudpy your_script
</code></pre>

<h2>
<a id="the-hard-way" class="anchor" href="#the-hard-way" aria-hidden="true"><span class="octicon octicon-link"></span></a>The hard way</h2>

<pre><code>$cloudpy -P your_script
</code></pre>

<p>You can do some modifications to the packed structure here</p>

<pre><code>$cloudpy -S your_package_name
</code></pre>

<p>Send to remote host. The package name has been return by "-P" command</p>

<pre><code>$cloudpy -R your_package_name
</code></pre>

<p>Run!</p>

<pre><code>$cloudpy -C your_package_name
</code></pre>

<h1></h1>

<p>Clean.</p>

<h1></h1>

<p>cloudpy可以将python程序（以及依赖的库和文件）打包至另一台机器，自动配置依赖的虚拟环境并实时返回结果。</p>

<p>cloudpy使用ssh在远程主机操作，因此需要能使用publish key 登陆ssh到远程主机。</p>

<p><strong>如果你需要在一台机器上编写程序并在另一台机器上测试/运行程序，cloudpy可能适合你。</strong></p>

<p><em>本地不需要安装要用的第三方库，但安装将会提高识别的准确度。</em></p>

<p><em>可以依赖其他文件、包或模块，cloudpy会试着解析所有依赖的文件并打包</em></p>

<h1>
<a id="安装" class="anchor" href="#%E5%AE%89%E8%A3%85" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装</h1>

<h2>
<a id="linuxmac-os-x" class="anchor" href="#linuxmac-os-x" aria-hidden="true"><span class="octicon octicon-link"></span></a>Linux/Mac OS X</h2>

<p>在本地和远程主机：    </p>

<pre><code>$ pip install cloudpy
</code></pre>

<p>远程主机还需要安装<code>virtualenv</code>。</p>

<h2>
<a id="windows" class="anchor" href="#windows" aria-hidden="true"><span class="octicon octicon-link"></span></a>Windows</h2>

<p>本地：</p>

<ol>
<li>安装Cygwin，安装rsync、openssh，配置ssh client</li>
<li>安装pip</li>
<li>
<p>安装cloudpy</p>

<p>$ pip install cloudpy</p>
</li>
</ol>

<p>远程主机不支持Windows</p>

<h1>
<a id="配置" class="anchor" href="#%E9%85%8D%E7%BD%AE" aria-hidden="true"><span class="octicon octicon-link"></span></a>配置</h1>

<p>cloudpy 依次在以下位置查找配置文件：</p>

<pre><code>1. /etc/cloudpy.conf
2. ~/.cloudpy.conf
3. ./cloudpy.conf
</code></pre>

<p>后一项的配置会覆盖前一项。</p>

<p>配置文件包含一个python字典：</p>

<pre><code>{
    "host":"ubuntu@192.168.70.145",
    "depository":"cloudpy_depo",
    "host_sep":"/"
}
</code></pre>

<p><code>host</code>为ssh到远程主机的用户名和地址。<br>
<code>depository</code>为远程主机上缓存文件的目录。<br>
<code>host_sep</code>为远程主机目录分隔符，大多数情况下为<code>"/"</code></p>

<h1>
<a id="使用" class="anchor" href="#%E4%BD%BF%E7%94%A8" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用</h1>

<h2>
<a id="简单的方法" class="anchor" href="#%E7%AE%80%E5%8D%95%E7%9A%84%E6%96%B9%E6%B3%95" aria-hidden="true"><span class="octicon octicon-link"></span></a>简单的方法:</h2>

<pre><code>$ cloudpy your_script
</code></pre>

<h2>
<a id="分步执行" class="anchor" href="#%E5%88%86%E6%AD%A5%E6%89%A7%E8%A1%8C" aria-hidden="true"><span class="octicon octicon-link"></span></a>分步执行</h2>

<p>cloudpy的执行分四步：pack、sync、run和clean。</p>

<h3>
<a id="pack" class="anchor" href="#pack" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pack</h3>

<p>pack步骤会查找脚本依赖的库、其他python文件并猜测使用到的其他文件，将之整理到合适的目录中。使用<code>-P</code> 参数执行pack过程。</p>

<pre><code>$ cloudpy -P your_script
</code></pre>

<p>命令返回生成的目录名称作为ID。</p>

<p>可以使用参数<code>-n name</code>和<code>-f</code>.</p>

<p><code>-n name</code>参数可以指定生成的目录名称。这样可以复用之前在远程机器上生成和安装好的环境。</p>

<p><code>-f</code>参数指定猜测可能用到的其他文件。</p>

<h4>
<a id="生成的信息文件说明" class="anchor" href="#%E7%94%9F%E6%88%90%E7%9A%84%E4%BF%A1%E6%81%AF%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E" aria-hidden="true"><span class="octicon octicon-link"></span></a>生成的信息文件说明</h4>

<p>生成的依赖信息在<code>conf/mods</code>中，不确定的依赖也在此文件中给出建议和可能的选项，需要手工修改指定。</p>

<h3>
<a id="sync" class="anchor" href="#sync" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sync</h3>

<p>Sync操作将Pack生成的目录同步到远程主机。<code>ID</code>为pack步骤返回的ID。</p>

<pre><code>$ cloudpy -S ID
</code></pre>

<h3>
<a id="run" class="anchor" href="#run" aria-hidden="true"><span class="octicon octicon-link"></span></a>Run</h3>

<p>Run操作在远程主机执行脚本并实时返回结果。</p>

<pre><code>$ cloudpy -R ID
</code></pre>

<p>可以使用<code>-N</code>、<code>-c</code>参数。</p>

<p><code>-N</code>参数输出更多的信息。包括环境的生成和配置信息。</p>

<p><code>-c</code>参数在程序运行完后删除远程主机相关缓存和环境。</p>

<h3>
<a id="clean" class="anchor" href="#clean" aria-hidden="true"><span class="octicon octicon-link"></span></a>Clean</h3>

<p>Clean操作删除本地生成的目录。</p>

<pre><code>$ cloudpy -C ID
</code></pre>

<h2>
<a id="参数说明" class="anchor" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E" aria-hidden="true"><span class="octicon octicon-link"></span></a>参数说明</h2>

<p>不指定具体执行步骤时，前述参数也可以使用。参数会被自动应用到对应的步骤。</p>

<p>如果不指定<code>-n name</code>，本地临时生成的目录完成后会被删除（相当于<code>-c</code>参数）。指定<code>-n name</code>参数时，不会执行Clean操作。</p>

<h1>
<a id="cloudpy-eval" class="anchor" href="#cloudpy-eval" aria-hidden="true"><span class="octicon octicon-link"></span></a>cloudpy-eval</h1>

<p><code>cloudpy-eval</code>在本机创建虚拟环境并执行一个pack好之后的包。</p>

<p>例如想要在远程主机后台运行某个程序，可以先：</p>

<pre><code>$ cloudpy -PSC your_script
</code></pre>

<p>将需要的文件同步到远程主机。然后ssh到远程主机并：</p>

<pre><code>$ nohup cloudpy-eval /path/to/depository/ID &amp;
</code></pre>

<p>这样你可以exit并稍后重新ssh回来查看运行结果。</p>

<p>可以使用<code>-q</code>和<code>-c</code>参数：</p>

<p><code>cloudpy-eval</code>默认输出全部信息，包括创建和安装虚拟环境。使用<code>-q</code>只显示程序输出。</p>

<p><code>-c</code>参数在执行完成后删除包。</p>

<h1></h1>
      </section>
    </div>

    
  </body>
</html>
